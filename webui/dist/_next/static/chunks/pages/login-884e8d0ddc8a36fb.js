(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{4699:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return t(2747)}])},2747:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return S}});var a=t(1527),l=t(3933),n=t(4271),r=t(959),i=t(2084),o=t(8944),c=t(9140);let d=i.fC,m=i.xz,x=e=>{let{className:s,children:t,...l}=e;return(0,a.jsx)(i.h_,{className:(0,c.cn)(s),...l,children:(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-start justify-center sm:items-center",children:t})})};x.displayName=i.h_.displayName;let u=r.forwardRef((e,s)=>{let{className:t,children:l,...n}=e;return(0,a.jsx)(i.aV,{className:(0,c.cn)("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm transition-all duration-100 data-[state=closed]:animate-out data-[state=open]:fade-in data-[state=closed]:fade-out",t),...n,ref:s})});u.displayName=i.aV.displayName;let h=r.forwardRef((e,s)=>{let{className:t,children:l,...n}=e;return(0,a.jsxs)(x,{children:[(0,a.jsx)(u,{}),(0,a.jsxs)(i.VY,{ref:s,className:(0,c.cn)("fixed z-50 grid w-full gap-4 rounded-b-lg bg-white p-6 animate-in data-[state=open]:fade-in-90 data-[state=open]:slide-in-from-bottom-10 sm:max-w-lg sm:rounded-lg sm:zoom-in-90 data-[state=open]:sm:slide-in-from-bottom-0","dark:bg-slate-900",t),...n,children:[l,(0,a.jsxs)(i.x8,{className:"absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-slate-100 dark:focus:ring-slate-400 dark:focus:ring-offset-slate-900 dark:data-[state=open]:bg-slate-800",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});h.displayName=i.VY.displayName;let f=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,c.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};f.displayName="DialogHeader";let p=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,c.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};p.displayName="DialogFooter";let g=r.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.Dx,{ref:s,className:(0,c.cn)("text-lg font-semibold text-slate-900","dark:text-slate-50",t),...l})});g.displayName=i.Dx.displayName;let N=r.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.dk,{ref:s,className:(0,c.cn)("text-sm text-slate-500","dark:text-slate-400",t),...l})});N.displayName=i.dk.displayName;var j=t(4624),w=t(9300),y=t(4379),v=t(4157),k=t(6131),b=t(6380),C=t(7765),_=t.n(C),R=t(3125);function S(){let e=(0,R.useRouter)(),{toast:s}=(0,y.pm)(),[t,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)(""),[x,u]=(0,r.useState)([]),[p,C]=(0,r.useState)("");(0,r.useEffect)(()=>{S(),t||v.t.OAuthProviders({}).then(e=>{u(e.providers)})},[]);let S=()=>{let e=k.Z.get(l.o3);if(void 0==e){i(!1);return}i(!0)},I=()=>{let t="";v.t.GenerateWechatQRCode({}).then(e=>{t=e.qrcode,C(e.url)}).catch(e=>{console.log("GenerateWechatQRCode error: ",e)});let a=setInterval(()=>{console.log("wechatQRCode: ".concat(t,", wechatQRCodeURL: ").concat(p)),v.t.GenrateToken({qrcode:t}).then(s=>{clearInterval(a),k.Z.set(l.o3,s.token),k.Z.set(l.kk,s.expiry),i(!0),e.push(w.J.links.home)}).catch(e=>{console.log("GenrateToken error: ",e)})},5e3);setTimeout(()=>{clearInterval(a),s({variant:"destructive",title:"Sign In error",description:"Sign In with QRCode timeout"})},3e5)};if(t)return e.push("/"),(0,a.jsx)("div",{className:"flex-grow container mx-auto flex flex-col p-8 items-center",children:(0,a.jsx)("div",{className:"prose m-4",children:(0,a.jsx)("h1",{children:"You are already logged in!"})})});let T=t=>{v.t.GenrateToken({magicCode:t}).then(s=>{k.Z.set(l.o3,s.token),k.Z.set(l.kk,s.expiry),i(!0),e.push(w.J.links.home)}).catch(e=>{s({variant:"destructive",title:"Sign In with MagicCode error",description:JSON.stringify(e)})})};return(0,a.jsxs)("div",{className:"flex-grow container mx-auto flex flex-col p-8 items-center",children:[(0,a.jsx)("div",{className:"prose m-4",children:(0,a.jsx)("h1",{children:"Please Login"})}),(0,a.jsxs)("div",{className:"container mx-auto max-w-sm flex flex-col bg-white space-y-2 items-center",children:[x.map(e=>void 0===e.url?(0,a.jsxs)(n.z,{disabled:!0,children:["Sign In with ",e.name]},e.name):(0,a.jsx)(_(),{href:e.url,className:"w-full",children:(0,a.jsxs)(n.z,{className:"w-full",children:["Sign In with ",e.name]})},e.name)),(0,a.jsxs)(d,{children:[(0,a.jsx)(m,{onClick:()=>I(),asChild:!0,children:(0,a.jsx)(n.z,{className:"w-full",children:"微信扫码登录"})}),(0,a.jsxs)(h,{children:[(0,a.jsxs)(f,{children:[(0,a.jsx)(g,{children:"请扫描下方二维码进行登录"}),(0,a.jsx)(N,{children:"需要先关注微信公众号"})]}),(0,a.jsx)("div",{className:"bg-indigo-300",children:(0,a.jsx)("img",{className:"object-cover h-full w-full ",src:p})})]})]}),(0,a.jsxs)(d,{children:[(0,a.jsx)(m,{onClick:()=>I(),asChild:!0,children:(0,a.jsx)(n.z,{className:"w-full",children:"使用 MagicCode 登录"})}),(0,a.jsxs)(h,{children:[(0,a.jsxs)(f,{children:[(0,a.jsx)(g,{className:"prose",children:"使用微信或者 Telegram 获取 MagicCode"}),(0,a.jsx)(N,{className:"prose",dangerouslySetInnerHTML:{__html:(0,b.TU)("微信搜索 **NotionBoy** 关注并回复 `/MagicCode`\n									<br />\n									OR\n									<br/>\n									Telegram 关注 [**NotionBoy**](https://t.me/TheNotionBoyBot) 并回复 `/MagicCode`\n									")}})]}),(0,a.jsxs)("div",{className:"flex w-full max-w-sm items-center space-x-2",children:[(0,a.jsx)(j.I,{type:"text",placeholder:"Sign In with MagicCode",value:o,onChange:e=>c(e.target.value)}),(0,a.jsx)(n.z,{type:"submit",onClick:()=>T(o),children:"Login"})]})]})]})]})]})}}},function(e){e.O(0,[593,990,477,774,888,179],function(){return e(e.s=4699)}),_N_E=e.O()}]);
