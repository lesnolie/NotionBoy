(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{25:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return s(5035)}])},5035:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var n=s(1527),o=s(959),r=s(8847),a=s(7935),c=s(8736),i=s(6380),l=s(9168);let d=Array(64),u=Array(123);for(let e=0;e<64;)u[d[e]=e<26?e+65:e<52?e+71:e<62?e-4:e-59|43]=e++;function h(e,t){return t&&t.constructor===Uint8Array?function(e,t,s){let n=null,o=[],r=0,a=0,c;for(;t<s;){let s=e[t++];switch(a){case 0:o[r++]=d[s>>2],c=(3&s)<<4,a=1;break;case 1:o[r++]=d[c|s>>4],c=(15&s)<<2,a=2;break;case 2:o[r++]=d[c|s>>6],o[r++]=d[63&s],a=0}r>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),r=0)}return(a&&(o[r++]=d[c],o[r++]=61,1===a&&(o[r++]=61)),n)?(r&&n.push(String.fromCharCode.apply(String,o.slice(0,r))),n.join("")):String.fromCharCode.apply(String,o.slice(0,r))}(t,0,t.length):t}function v(e,t){let{pathPrefix:s,...n}=t||{},o=s?"".concat(s).concat(e):e;return fetch(o,n).then(e=>e.json().then(t=>{if(!e.ok)throw t;return t}))}function g(e){return["string","number","boolean"].some(t=>typeof e===t)}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=function e(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.keys(t).reduce((n,o)=>{let r=t[o],a=s?[s,o].join("."):o,c=Array.isArray(r)&&r.every(e=>g(e))&&r.length>0,i=g(r)&&!(!1===r||0===r||""===r),l={};return!function(e){let t="Object"===Object.prototype.toString.call(e).slice(8,-1);if(!(null!==e&&t)||!t)return!1;let s=Object.getPrototypeOf(e),n="object"==typeof s&&s.constructor===Object.prototype.constructor;return n}(r)?(i||c)&&(l={[a]:r}):l=e(r,a),{...n,...l}},{})}(e),n=Object.keys(s).reduce((e,n)=>{let o=s[n];return t.find(e=>e===n)?e:Array.isArray(o)?[...e,...o.map(e=>[n,e.toString()])]:e=[...e,[n,o.toString()]]},[]);return new URLSearchParams(n).toString()}class m{static Status(e,t){return v("/v1/status?".concat(f(e,[])),{...t,method:"GET"})}static GenrateToken(e,t){return v("/v1/auth/token",{...t,method:"POST"})}static GenerateApiKey(e,t){return v("/v1/auth/apikey",{...t,method:"POST"})}static DeleteApiKey(e,t){return v("/v1/auth/apikey",{...t,method:"DELETE"})}static CreateConversation(e,t){return v("/v1/conversations",{...t,method:"POST",body:JSON.stringify(e,h)})}static GetConversation(e,t){return v("/v1/conversations/".concat(e.id,"?").concat(f(e,["id"])),{...t,method:"GET"})}static ListConversations(e,t){return v("/v1/conversations?".concat(f(e,[])),{...t,method:"GET"})}static DeleteConversation(e,t){return v("/v1/conversations/".concat(e.id),{...t,method:"DELETE"})}static CreateMessage(e,t){return v("/v1/conversations/".concat(e.conversationId,"/messages"),{...t,method:"POST",body:JSON.stringify(e,h)})}static GetMessage(e,t){return v("/v1/conversations/".concat(e.conversationId,"/messages/").concat(e.id,"?").concat(f(e,["conversationId","id"])),{...t,method:"GET"})}static ListMessages(e,t){return v("/v1/conversations/".concat(e.conversationId,"/messages?").concat(f(e,["conversationId"])),{...t,method:"GET"})}static DeleteMessage(e,t){return v("/v1/conversations/".concat(e.conversationId,"/messages/").concat(e.id),{...t,method:"DELETE"})}}function b(e){return{__html:(0,i.TU)(e)}}function p(){let[e,t]=(0,o.useState)([]),[s,i]=(0,o.useState)({id:(0,l.Z)()}),[d,u]=(0,o.useState)(""),[h,v]=(0,o.useState)([]),[g,f]=(0,o.useState)(""),[p,x]=(0,o.useState)(!1),[y,j]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=[];m.ListConversations({}).then(s=>{console.log("ListConversations",s),void 0!==s.conversations&&t(e=s.conversations)}).catch(e=>{console.log(e)});let s={id:(0,l.Z)(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};i(s),t([...e,s])},[]),(0,o.useEffect)(()=>{void 0!==s.id&&(console.log("currentConversation",JSON.stringify(s)),u(s.id),void 0===s.messages&&w(d))},[s]);let S=()=>{let s={id:(0,l.Z)(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),messages:[]};i(s),t([...e,s])},w=e=>{void 0!==e&&""!==e&&m.ListMessages({conversationId:e}).then(e=>{var t,n,o;console.log("handleConversationClick list messages: ",e),null===(t=e.messages)||void 0===t||t.sort((e,t)=>void 0===e.createdAt?1:void 0===t.createdAt?-1:new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()),v(null!==(n=e.messages)&&void 0!==n?n:[]);let r=s;r.messages=null!==(o=e.messages)&&void 0!==o?o:[],i(r)}).catch(e=>{console.log("handleConversationClick list message error: ",e)})},C=t=>{void 0!=t.id&&e.forEach(e=>{e.id===t.id&&i(e)})},N=e=>{if(void 0===e||""===e)return;j(!0),console.log("handleMessageSend",s.id,e),f("");let t={conversationId:s.id,request:e};v([...h,{id:(0,l.Z)(),conversationId:s.id,request:e}]),m.CreateMessage(t).then(e=>{v([...h,e])}).catch(e=>{console.log(e)}),j(!1),f("")},k=()=>{x(!p)};return(0,n.jsxs)("div",{className:"w-full h-screen flex flex-row overflow-hidden",children:[(0,n.jsx)("header",{children:(0,n.jsx)("title",{children:"NotionBoy Chat"})}),p&&(0,n.jsxs)("div",{className:"h-full flex flex-col max-w-lg bg-gray-400 text-white",children:[(0,n.jsx)("button",{className:"btn",onClick:S,children:(0,n.jsx)(r.Z,{})},"button"),e.map(e=>(0,n.jsx)("button",{className:"btn hover:bg-slate-500 focus:bg-slate-800",value:d,onClick:()=>C(e),children:(0,n.jsx)("p",{children:e.id})},e.id))]}),(0,n.jsxs)("div",{className:"flex-1 w-full flex flex-col bg-gray-2",children:[(0,n.jsxs)("div",{className:"w-full h-12 bg-success dark:bg-black items-center justify-between flex flex-row rounded-lg",children:[(0,n.jsx)("button",{className:"btn bg-success dark:bg-black border-0",onClick:k,children:(0,n.jsx)(c.Z,{})}),(0,n.jsx)("div",{className:"prose",children:(0,n.jsx)("h1",{children:"NotionBoy Chat"})}),(0,n.jsx)("div",{})]}),(0,n.jsx)("div",{className:"flex-1 w-full flex flex-col overflow-auto box-border bg-stone-100 dark:bg-neutral-focus rounded-lg p-4",children:h.map(e=>(0,n.jsxs)("div",{children:[void 0!==e.request&&""!==e.request&&(0,n.jsx)("div",{className:"chat chat-start",children:(0,n.jsx)("div",{className:"chat-bubble chat-bubble-accent prose text-sm",dangerouslySetInnerHTML:b(e.request)})},"".concat(e.id,"-req")),void 0!==e.response&&""!==e.response&&(0,n.jsx)("div",{className:"chat chat-end",children:(0,n.jsx)("div",{className:"chat-bubble chat-bubble-info prose text-sm",dangerouslySetInnerHTML:b(e.response)})},"".concat(e.id,"-resp"))]},e.id))}),y&&(0,n.jsx)("progress",{className:"progress w-full"}),(0,n.jsx)("div",{className:"w-full",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:"text",placeholder:"Type here",className:"input input-bordered w-full p-2",onChange:e=>f(e.target.value),value:g,onKeyDown:e=>{"Enter"===e.key&&N(g)}}),(0,n.jsx)("button",{className:"absolute right-2 mt-2 p-1 disabled:opacity-50",disabled:y,onClick:()=>N(g),children:(0,n.jsx)(a.Z,{})})]})})]})]})}}},function(e){e.O(0,[758,774,888,179],function(){return e(e.s=25)}),_N_E=e.O()}]);
